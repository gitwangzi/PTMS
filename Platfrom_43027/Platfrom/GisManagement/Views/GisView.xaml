<UserControl  x:Class="GisManagement.Views.GisView"
    xmlns:Controls="clr-namespace:Gsafety.Common.Controls;assembly=CommonControls" 
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:esri="http://schemas.esri.com/arcgis/client/2009"   
    xmlns:slData="clr-namespace:System.Windows.Controls;assembly=System.Windows.Controls.Data"
    xmlns:slPrimitives="clr-namespace:System.Windows.Controls.Primitives;assembly=System.Windows.Controls.Data"          
    xmlns:toolkit="http://schemas.microsoft.com/winfx/2006/xaml/presentation/toolkit"
    xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
    xmlns:ia="http://schemas.microsoft.com/expression/2010/interactions"
    xmlns:sdk="http://schemas.microsoft.com/winfx/2006/xaml/presentation/sdk"
    xmlns:ei="http://schemas.microsoft.com/expression/2010/interactions"
    xmlns:view="clr-namespace:GisManagement.Views"   
    xmlns:vm="clr-namespace:GisManagement.ViewModels" 
    mc:Ignorable="d"
    d:DesignHeight="600" d:DesignWidth="1000">
    <UserControl.Resources>
        <Style x:Key="NavigationStyleSpan" TargetType="esri:Navigation">
            <Setter Property="Background" Value="#FF8599C2"/>
            <Setter Property="Foreground" Value="#FF333333"/>
            <Setter Property="BorderBrush" Value="White"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
            <Setter Property="VerticalAlignment" Value="Top"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="esri:Navigation">
                        <Grid x:Name="LayoutRoot" Background="#00FFFFFF" HorizontalAlignment="Left" MinWidth="148" MinHeight="125" RenderTransformOrigin="{TemplateBinding RenderTransformOrigin}" VerticalAlignment="Top">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RenderTransform>
                                <ScaleTransform CenterY="0" CenterX="0"/>
                            </Grid.RenderTransform>
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="CommonStates">
                                    <VisualState x:Name="Normal">
                                        <Storyboard>
                                            <DoubleAnimation Duration="0:0:0.1" To="0.75" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" Storyboard.TargetName="LayoutRoot"/>
                                            <DoubleAnimation Duration="0:0:0.1" To="0.75" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" Storyboard.TargetName="LayoutRoot"/>
                                            <DoubleAnimation BeginTime="00:00:00" Duration="0:0:0.1" To="0.25" Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="LayoutRoot"/>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="MouseOver">
                                        <Storyboard>
                                            <DoubleAnimation BeginTime="00:00:00" Duration="0:0:0.1" To="1" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" Storyboard.TargetName="LayoutRoot"/>
                                            <DoubleAnimation BeginTime="00:00:00" Duration="0:0:0.1" To="1" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" Storyboard.TargetName="LayoutRoot"/>
                                            <DoubleAnimation BeginTime="00:00:00" Duration="0:0:0.1" To="0.75" Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="LayoutRoot"/>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                            <Grid x:Name="ZoomContainer" Margin="0" VerticalAlignment="Center">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Rectangle Grid.ColumnSpan="4" Fill="{TemplateBinding Background}" Margin="0,0,0,0" RadiusY="3" RadiusX="3" Grid.RowSpan="4" Stroke="{TemplateBinding BorderBrush}" StrokeThickness="1"/>
                                <Button x:Name="ZoomInButton" Foreground="{TemplateBinding Foreground}" FontSize="8"  Margin="2,2,2,0" Grid.Row="0" ToolTipService.ToolTip="{Binding [GIS_ZoomIn], Source={StaticResource SR}}" >
                                    <Button.Content>
                                        <TextBlock Text="+" Margin="0,0,0,0" ></TextBlock>
                                    </Button.Content>
                                </Button>
                                <Rectangle Fill="White" HorizontalAlignment="Center" Height="3" Grid.Row="1" VerticalAlignment="Center" Width="2"/>
                                <Slider x:Name="ZoomSlider" Cursor="Hand" Height="89" LargeChange="1" Maximum="15" Minimum="0"  Orientation="Vertical" Grid.Row="1" SmallChange="1" ToolTipService.ToolTip="{Binding [GIS_DragZoomInorOut], Source={StaticResource SR}}" Value="0" VerticalAlignment="Top"/>
                                <Button x:Name="ZoomOutButton"  Foreground="{TemplateBinding Foreground}" FontSize="8"   Margin="2,0,2,2" Grid.Row="2" ToolTipService.ToolTip="{Binding [GIS_ZoomOut], Source={StaticResource SR}}" >
                                    <Button.Content>
                                        <TextBlock Text="-" Margin="0,0,0,0" ></TextBlock>
                                    </Button.Content>
                                </Button>
                            </Grid>
                            <Grid x:Name="Navigator" Grid.Column="1" Height="125" Margin="3,0,0,0" RenderTransformOrigin="0.5,0.5" Width="125">
                                <Grid.RenderTransform>
                                    <RotateTransform x:Name="TransformRotate" Angle="0"/>
                                </Grid.RenderTransform>
                                <Path x:Name="RotateRing" Cursor="Hand" Data="M97.050499,68.386246 L106.5,68.386246 L106.1507,69.74157 C101.85528,83.519669 92.276138,94.975006 79.777817,101.74873 C76.653244,103.44215 73.34623,104.84298 69.893723,105.91433 L69.5,106.01534 L69.5,96.482994 L71.447334,95.771919 C74.205498,94.608025 76.826485,93.184006 79.279457,91.530655 C84.185387,88.223969 88.419128,84.000031 91.733521,79.105515 C93.390709,76.658241 94.818054,74.043327 95.98465,71.29158 z M0.5,68.386246 L9.9494915,68.386246 L11.015333,71.29158 C12.181933,74.043343 13.609276,76.658241 15.266468,79.105515 C18.580849,84.000053 22.814623,88.223969 27.720554,91.530655 C30.173519,93.18399 32.794529,94.608032 35.552677,95.771912 L38.5,96.848145 L38.5,106.27186 L37.106312,105.91433 C23.296202,101.62891 11.814036,92.07193 5.0245867,79.602684 C3.3272135,76.485374 1.923135,73.186035 0.8492955,69.741547 z M69.5,0.75652671 L69.893661,0.85751152 C83.703682,5.14291 95.185875,14.699864 101.97538,27.169144 C103.67275,30.286457 105.07684,33.585789 106.15069,37.030285 L106.5,38.38562 L97.050507,38.38562 L95.984657,35.480282 C94.818062,32.728535 93.390701,30.113619 91.733528,27.666359 C88.419121,22.771801 84.185356,18.547873 79.279427,15.241194 C76.826447,13.58785 74.205452,12.163824 71.447311,10.999947 L69.5,10.288876 z M38.5,0.5 L38.5,9.9237194 L35.552654,10.999952 C32.794514,12.163842 30.173498,13.587873 27.720541,15.241213 C22.81461,18.547897 18.580839,22.771828 15.266464,27.666361 C13.609274,30.113626 12.181928,32.728542 11.015331,35.480286 L9.9494915,38.38562 L0.5,38.38562 L0.84929955,37.030308 C5.1446834,23.252361 14.723901,11.796858 27.222183,5.02314 C30.346762,3.3297043 33.653778,1.928881 37.106293,0.85752773 z" Fill="{TemplateBinding Background}" Margin="8" Stretch="Fill" Stroke="{TemplateBinding BorderBrush}" ToolTipService.ToolTip="{Binding [DragToRotate], Source={StaticResource SR}}"/>
                                <Grid x:Name="PanLeft" Cursor="Hand" HorizontalAlignment="Left" Margin="0" ToolTipService.ToolTip="{Binding [GIS_PanWest], Source={StaticResource SR}}" VerticalAlignment="Center" Width="25">
                                    <Ellipse Fill="{TemplateBinding Background}" Height="24.5" Stroke="{TemplateBinding BorderBrush}" Width="25"/>
                                    <Path Data="M48,71 L40,76 L48,81 z" Fill="#FFFFFFFF" Height="13" Canvas.Left="7" Margin="7.836,6,9.164,6" Stretch="Fill" Stroke="#FFFFFFFF" Canvas.Top="5.75" Width="8"/>
                                </Grid>
                                <Grid x:Name="PanRight" Cursor="Hand" HorizontalAlignment="Right" Margin="0" RenderTransformOrigin="0.5,0.5" ToolTipService.ToolTip="{Binding [GIS_PanEast], Source={StaticResource SR}}" VerticalAlignment="Center" Width="25">
                                    <Grid.RenderTransform>
                                        <RotateTransform Angle="180"/>
                                    </Grid.RenderTransform>
                                    <Ellipse Fill="{TemplateBinding Background}" Height="24.5" Stroke="{TemplateBinding BorderBrush}" Width="25"/>
                                    <Path Data="M48,71 L40,76 L48,81 z" Fill="#FFFFFFFF" Height="13" Canvas.Left="7" Margin="7.836,6,9.164,6" Stretch="Fill" Stroke="#FFFFFFFF" Canvas.Top="5.75" Width="8"/>
                                </Grid>
                                <Grid x:Name="PanUp" Cursor="Hand" HorizontalAlignment="Center" Height="25" Margin="0" RenderTransformOrigin="0.5,0.5" ToolTipService.ToolTip="{Binding [GIS_PanNorth], Source={StaticResource SR}}" VerticalAlignment="Top">
                                    <Grid.RenderTransform>
                                        <RotateTransform Angle="90"/>
                                    </Grid.RenderTransform>
                                    <Ellipse Fill="{TemplateBinding Background}" Height="24.5" Stroke="{TemplateBinding BorderBrush}" Width="25"/>
                                    <Path Data="M49.643433,70.53167 L37.857143,76 L49.572575,81.46917 z" Fill="#FFFFFFFF" Height="14.125" Canvas.Left="4.906" Margin="5.672,5.5,8.015,5.375" Stretch="Fill" Stroke="#FFFFFFFF" Canvas.Top="4.906" Width="11.313"/>
                                    <Path Data="M92,29.833334 L92.000114,24.166691 L93.247681,24.184656 L96.134811,27.716934 L96.076241,24.166662 L97.444435,24.166662 L97.444435,29.833332 L96.218758,29.810295 L93.332748,26.418152 L93.361107,29.808037 z" Fill="{TemplateBinding Foreground}" Height="5.322" Canvas.Left="10.746" RenderTransformOrigin="0.506,0.5" Stretch="Fill" Canvas.Top="9.367" Width="4.416">
                                        <Path.RenderTransform>
                                            <RotateTransform Angle="90"/>
                                        </Path.RenderTransform>
                                    </Path>
                                    <Path Data="M91.666664,39" Fill="#FF000000" Height="1" Canvas.Left="10.375" RenderTransformOrigin="0.5,0.5" Stretch="Fill" Stroke="#FF000000" Canvas.Top="9.417" Width="1">
                                        <Path.RenderTransform>
                                            <TransformGroup>
                                                <RotateTransform Angle="90"/>
                                                <TranslateTransform X="3.5064478404741046" Y="0.50863583808085222"/>
                                            </TransformGroup>
                                        </Path.RenderTransform>
                                    </Path>
                                </Grid>
                                <Grid x:Name="PanDown" Cursor="Hand" HorizontalAlignment="Center" Height="25" Margin="0" RenderTransformOrigin="0.5,0.5" ToolTipService.ToolTip="{Binding [GIS_PanSouth], Source={StaticResource SR}}" VerticalAlignment="Bottom">
                                    <Grid.RenderTransform>
                                        <RotateTransform Angle="270"/>
                                    </Grid.RenderTransform>
                                    <Ellipse Fill="{TemplateBinding Background}" Height="24.5" Stroke="{TemplateBinding BorderBrush}" Width="25"/>
                                    <Path Data="M48,71 L40,76 L48,81 z" Fill="#FFFFFFFF" Height="13" Canvas.Left="7" Margin="7.172,6,9.828,6" Stretch="Fill" Stroke="#FFFFFFFF" Canvas.Top="5.75" Width="8"/>
                                </Grid>
                            </Grid>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Storyboard x:Name="showHistoryLine">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.ScaleY)" Storyboard.TargetName="HistoryLine">
                <EasingDoubleKeyFrame KeyTime="0" Value="0"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.2" Value="1"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>

        <Storyboard x:Name="hiddenHistoryLine">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.ScaleY)" Storyboard.TargetName="HistoryLine">
                <EasingDoubleKeyFrame KeyTime="0" Value="1"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.2" Value="0"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>

    </UserControl.Resources>

    <Grid x:Name="LayoutRoot" Background="White">

        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="ControlQueryPanel">
                <VisualStateGroup.Transitions>
                    <VisualTransition GeneratedDuration="0:0:0.4">
                        <VisualTransition.GeneratedEasingFunction>
                            <PowerEase EasingMode="EaseOut"/>
                        </VisualTransition.GeneratedEasingFunction>
                    </VisualTransition>
                </VisualStateGroup.Transitions>
                <VisualState x:Name="showQueryPanel">
                    <Storyboard>
                        <DoubleAnimation Duration="0" To="1" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.ScaleX)" Storyboard.TargetName="AddressQuery" d:IsOptimized="True"/>
                        <DoubleAnimation Duration="0" To="1" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.ScaleY)" Storyboard.TargetName="AddressQuery" d:IsOptimized="True"/>
                        <DoubleAnimation Duration="0" To="1" Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="AddressQuery" d:IsOptimized="True"/>
                    </Storyboard>
                </VisualState>
                <VisualState x:Name="hiddenQueryPanel">
                    <Storyboard/>
                </VisualState>
            </VisualStateGroup>
            <VisualStateGroup x:Name="ControlZoomDistPanel">
                <VisualStateGroup.Transitions>
                    <VisualTransition GeneratedDuration="0:0:0.4">
                        <VisualTransition.GeneratedEasingFunction>
                            <PowerEase EasingMode="EaseOut"/>
                        </VisualTransition.GeneratedEasingFunction>
                    </VisualTransition>
                </VisualStateGroup.Transitions>
                <VisualState x:Name="showControlZoomDistPanel">
                    <Storyboard>
                        <DoubleAnimation Duration="0" To="1" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.ScaleX)" Storyboard.TargetName="ZoomToDist" d:IsOptimized="True"/>
                        <DoubleAnimation Duration="0" To="1" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.ScaleY)" Storyboard.TargetName="ZoomToDist" d:IsOptimized="True"/>
                        <DoubleAnimation Duration="0" To="1" Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="ZoomToDist" d:IsOptimized="True"/>
                    </Storyboard>
                </VisualState>
                <VisualState x:Name="hiddenControlZoomDistPanel">
                    <Storyboard/>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
        <Grid.Resources>
            <ControlTemplate x:Key="EditVertexSymbol">
                <Ellipse x:Name="root" Width="7" Height="7" Cursor="Hand" Stroke="Black" StrokeThickness="0" Fill="Yellow">
                    <VisualStateManager.VisualStateGroups>
                        <VisualStateGroup x:Name="SelectionStates">
                            <VisualState x:Name="Unselected" />
                            <VisualState x:Name="Selected">
                                <Storyboard>
                                    <DoubleAnimation BeginTime="00:00:00" Storyboard.TargetName="root" Storyboard.TargetProperty="StrokeThickness" To="1" Duration="0" />
                                    <ColorAnimation BeginTime="00:00:00" Storyboard.TargetName="root" Storyboard.TargetProperty="(Rectangle.Fill).(SolidColorBrush.Color)" To="Transparent" Duration="0" />
                                    <ObjectAnimationUsingKeyFrames BeginTime="0" Storyboard.TargetName="root" Storyboard.TargetProperty="(FrameworkElement.Cursor)">
                                        <DiscreteObjectKeyFrame KeyTime="0">
                                            <DiscreteObjectKeyFrame.Value>
                                                <Cursor>None</Cursor>
                                            </DiscreteObjectKeyFrame.Value>
                                        </DiscreteObjectKeyFrame>
                                    </ObjectAnimationUsingKeyFrames>
                                </Storyboard>
                            </VisualState>
                        </VisualStateGroup>
                    </VisualStateManager.VisualStateGroups>
                </Ellipse>
            </ControlTemplate>

            <esri:MarkerSymbol x:Key="EditMarkerSymbol" OffsetX="9" OffsetY="9">
                <esri:MarkerSymbol.ControlTemplate>
                    <ControlTemplate>
                        <Ellipse x:Name="root" Width="18" Height="18" Cursor="Hand" Stroke="Black" StrokeThickness="0" Fill="Blue">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="SelectionStates">
                                    <VisualState x:Name="Unselected" />
                                    <VisualState x:Name="Selected">
                                        <Storyboard>
                                            <DoubleAnimation BeginTime="00:00:00" Storyboard.TargetName="root" Storyboard.TargetProperty="StrokeThickness" To="1" Duration="0" />
                                            <ColorAnimation BeginTime="00:00:00" Storyboard.TargetName="root" Storyboard.TargetProperty="(Rectangle.Fill).(SolidColorBrush.Color)" To="Transparent" Duration="0" />
                                            <ObjectAnimationUsingKeyFrames BeginTime="0" Storyboard.TargetName="root" Storyboard.TargetProperty="(FrameworkElement.Cursor)">
                                                <DiscreteObjectKeyFrame KeyTime="0">
                                                    <DiscreteObjectKeyFrame.Value>
                                                        <Cursor>None</Cursor>
                                                    </DiscreteObjectKeyFrame.Value>
                                                </DiscreteObjectKeyFrame>
                                            </ObjectAnimationUsingKeyFrames>

                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                        </Ellipse>
                    </ControlTemplate>
                </esri:MarkerSymbol.ControlTemplate>
            </esri:MarkerSymbol>

            <ControlTemplate x:Key="ScalePointSymbol">
                <Ellipse x:Name="root" Width="10" Height="10" Cursor="Hand" Stroke="Black" StrokeThickness="0.5" Fill="Red">
                    <VisualStateManager.VisualStateGroups>
                        <VisualStateGroup x:Name="SelectionStates">
                            <VisualState x:Name="Unselected" />
                            <VisualState x:Name="Selected">
                                <Storyboard>
                                    <DoubleAnimation BeginTime="00:00:00" Storyboard.TargetName="root" Storyboard.TargetProperty="StrokeThickness" To="1" Duration="0" />
                                    <ColorAnimation BeginTime="00:00:00" Storyboard.TargetName="root" Storyboard.TargetProperty="(Rectangle.Fill).(SolidColorBrush.Color)" To="Yellow" Duration="0" />
                                    <ObjectAnimationUsingKeyFrames BeginTime="0" Storyboard.TargetName="root" Storyboard.TargetProperty="(FrameworkElement.Cursor)">
                                        <DiscreteObjectKeyFrame KeyTime="0">
                                            <DiscreteObjectKeyFrame.Value>
                                                <Cursor>None</Cursor>
                                            </DiscreteObjectKeyFrame.Value>
                                        </DiscreteObjectKeyFrame>
                                    </ObjectAnimationUsingKeyFrames>

                                </Storyboard>
                            </VisualState>
                        </VisualStateGroup>
                    </VisualStateManager.VisualStateGroups>
                </Ellipse>
            </ControlTemplate>

            <ControlTemplate x:Key="RotatePointSymbol">
                <Grid  Width="10" Height="20"  x:Name="root" Cursor="Hand" >
                    <Grid.RowDefinitions>
                        <RowDefinition/>
                        <RowDefinition/>
                    </Grid.RowDefinitions>
                    <Ellipse x:Name="rect" Stroke="Black" StrokeThickness="0.5" Fill="Green"/>
                    <Rectangle Width="1" Grid.Row="1" Fill="Black" HorizontalAlignment="Center" />
                    <VisualStateManager.VisualStateGroups>
                        <VisualStateGroup x:Name="SelectionStates">
                            <VisualState x:Name="Unselected" />
                            <VisualState x:Name="Selected">
                                <Storyboard>
                                    <DoubleAnimation BeginTime="00:00:00" Storyboard.TargetName="rect" Storyboard.TargetProperty="StrokeThickness" To="1" Duration="0" />
                                    <ColorAnimation BeginTime="00:00:00" Storyboard.TargetName="rect" Storyboard.TargetProperty="(Rectangle.Fill).(SolidColorBrush.Color)" To="Yellow" Duration="0" />
                                    <ObjectAnimationUsingKeyFrames BeginTime="0" Storyboard.TargetName="root" Storyboard.TargetProperty="(FrameworkElement.Cursor)">
                                        <DiscreteObjectKeyFrame KeyTime="0">
                                            <DiscreteObjectKeyFrame.Value>
                                                <Cursor>None</Cursor>
                                            </DiscreteObjectKeyFrame.Value>
                                        </DiscreteObjectKeyFrame>
                                    </ObjectAnimationUsingKeyFrames>

                                </Storyboard>
                            </VisualState>
                        </VisualStateGroup>
                    </VisualStateManager.VisualStateGroups>
                </Grid>
            </ControlTemplate>

            <ControlTemplate x:Key="EditLineSymbol">
                <Path x:Name="Element"
                    Stroke="{Binding Symbol.Color}"
                    StrokeStartLineCap="Round"
                    StrokeThickness="{Binding Symbol.Width}"
                    StrokeLineJoin="Round"
                    StrokeEndLineCap="Round" 
                    StrokeDashArray="3 2" 
                    Fill="{x:Null}" />
            </ControlTemplate>

            <esri:MarkerSymbol x:Key="MyVertexSymbol" ControlTemplate="{StaticResource EditVertexSymbol}" OffsetX="3.5" OffsetY="3.5"/>
            <esri:MarkerSymbol x:Key="MyScaleSymbol" ControlTemplate="{StaticResource ScalePointSymbol}" OffsetX="5" OffsetY="5"/>
            <esri:MarkerSymbol x:Key="MyRotateSymbol" ControlTemplate="{StaticResource RotatePointSymbol}" OffsetX="5" OffsetY="20"/>
            <esri:LineSymbol x:Key="MyScaleBox" ControlTemplate="{StaticResource EditLineSymbol}" Color="Black" Width="5"/>
            <esri:EditGeometry x:Key="MyEditGeometry"                                
                               IsEnabled="True" 
                               VertexSymbol="{StaticResource MyVertexSymbol}"							   
                               ScalePointSymbol="{StaticResource MyScaleSymbol}"
                               ScaleBoxSymbol="{StaticResource MyScaleBox}"
                               RotatePointSymbol="{StaticResource MyRotateSymbol}"/>

            <esri:SimpleMarkerSymbol x:Key="DefaultMarkerSymbol" Color="Red" Size="12" Style="Circle" />
            <esri:SimpleLineSymbol x:Key="DefaultLineSymbol" Color="Red" Width="4" />
            <esri:FillSymbol x:Key="DefaultFillSymbol" >
                <esri:FillSymbol.ControlTemplate>
                    <ControlTemplate>
                        <Path x:Name="Element" IsHitTestVisible="True" Fill="#66FF0000"
                            Stroke="Red" StrokeThickness="1"/>
                    </ControlTemplate>
                </esri:FillSymbol.ControlTemplate>
            </esri:FillSymbol>
            <Style TargetType="Button">
                <Setter Property="Background" Value="#FF1F3B53"/>
                <Setter Property="Foreground" Value="#FF000000"/>
                <Setter Property="Padding" Value="3"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="BorderBrush">
                    <Setter.Value>
                        <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                            <GradientStop Color="#FFA3AEB9" Offset="0"/>
                            <GradientStop Color="#FF8399A9" Offset="0.375"/>
                            <GradientStop Color="#FF718597" Offset="0.375"/>
                            <GradientStop Color="#FF617584" Offset="1"/>
                        </LinearGradientBrush>
                    </Setter.Value>
                </Setter>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Grid>
                                <VisualStateManager.VisualStateGroups>
                                    <VisualStateGroup x:Name="CommonStates">
                                        <VisualState x:Name="Normal"/>
                                        <VisualState x:Name="MouseOver">
                                            <Storyboard>
                                                <DoubleAnimation Duration="0" To="1" 
                                                                 Storyboard.TargetProperty="Opacity" Storyboard.TargetName="BackgroundAnimation"/>
                                                <ColorAnimation Duration="0" To="#F2FFFFFF" 
                                                                Storyboard.TargetProperty="(Rectangle.Fill).(GradientBrush.GradientStops)[1].(GradientStop.Color)" Storyboard.TargetName="BackgroundGradient"/>
                                                <ColorAnimation Duration="0" To="#CCFFFFFF" 
                                                                Storyboard.TargetProperty="(Rectangle.Fill).(GradientBrush.GradientStops)[2].(GradientStop.Color)" Storyboard.TargetName="BackgroundGradient"/>
                                                <ColorAnimation Duration="0" To="#7FFFFFFF" 
                                                                Storyboard.TargetProperty="(Rectangle.Fill).(GradientBrush.GradientStops)[3].(GradientStop.Color)" Storyboard.TargetName="BackgroundGradient"/>
                                            </Storyboard>
                                        </VisualState>
                                        <VisualState x:Name="Pressed">
                                            <Storyboard>
                                                <ColorAnimation Duration="0" To="#D8FFFFFF" 
                                                                Storyboard.TargetProperty="(Rectangle.Fill).(GradientBrush.GradientStops)[0].(GradientStop.Color)" Storyboard.TargetName="BackgroundGradient"/>
                                                <ColorAnimation Duration="0" To="#C6FFFFFF" 
                                                                Storyboard.TargetProperty="(Rectangle.Fill).(GradientBrush.GradientStops)[1].(GradientStop.Color)" Storyboard.TargetName="BackgroundGradient"/>
                                                <ColorAnimation Duration="0" To="#8CFFFFFF" 
                                                                Storyboard.TargetProperty="(Rectangle.Fill).(GradientBrush.GradientStops)[2].(GradientStop.Color)" Storyboard.TargetName="BackgroundGradient"/>
                                            </Storyboard>
                                        </VisualState>
                                    </VisualStateGroup>
                                    <VisualStateGroup x:Name="MyStates">
                                        <VisualState x:Name="Selected">
                                            <Storyboard>
                                                <ColorAnimation 
                                                    Duration="0" 
                                                    To="Red" 
                                                    Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)" 
                                                    Storyboard.TargetName="Background"/>
                                            </Storyboard>
                                        </VisualState>
                                        <VisualState x:Name="UnSelected">
                                            <Storyboard>
                                                <ColorAnimation 
                                                    Duration="0" 
                                                    To="White" 
                                                    Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)" 
                                                    Storyboard.TargetName="Background"/>
                                            </Storyboard>
                                        </VisualState>
                                    </VisualStateGroup>
                                </VisualStateManager.VisualStateGroups>
                                <Border x:Name="Background" BorderBrush="{TemplateBinding BorderBrush}" 
                                        BorderThickness="{TemplateBinding BorderThickness}" 
                                        Background="White" 
                                        CornerRadius="3">
                                    <Grid Background="{TemplateBinding Background}" 
                                          Margin="1">
                                        <Border x:Name="BackgroundAnimation" 
                                                Background="#FF448DCA" 
                                                Opacity="0"/>
                                        <Rectangle x:Name="BackgroundGradient">
                                            <Rectangle.Fill>
                                                <LinearGradientBrush EndPoint=".7,1" StartPoint=".7,0">
                                                    <GradientStop Color="#FFFFFFFF" Offset="0"/>
                                                    <GradientStop Color="#F9FFFFFF" Offset="0.375"/>
                                                    <GradientStop Color="#E5FFFFFF" Offset="0.625"/>
                                                    <GradientStop Color="#C6FFFFFF" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Rectangle.Fill>
                                        </Rectangle>
                                    </Grid>
                                </Border>
                                <ContentPresenter x:Name="contentPresenter" 
                                                  ContentTemplate="{TemplateBinding ContentTemplate}" 
                                                  Content="{TemplateBinding Content}" 
                                                  HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                                                  Margin="{TemplateBinding Padding}" 
                                                  VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <ResourceDictionary x:Key="PrintTemplates">
                <ControlTemplate x:Key="Map Only">
                    <esri:Map x:Name="PrintMap" Background="White"
                                  IsLogoVisible="False" view:CloneMap.Map="{Binding Map}" />
                </ControlTemplate>

                <!--  Print map with header and footer  -->
                <ControlTemplate x:Key="With Header And Footer">
                    <Grid Background="White">
                        <Grid Margin="10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <!--  Title  -->
                            <TextBlock HorizontalAlignment="Center" FontSize="14"
                                           Text="{Binding Title}" TextWrapping="Wrap" />

                            <!--  Map with scale line and attribution  -->
                            <Border Grid.Row="1" Background="Transparent"
                                        BorderBrush="Black" BorderThickness="1">
                                <Grid>
                                    <esri:Map x:Name="PrintMap" IsLogoVisible="False" view:CloneMap.Map="{Binding Map}" />
                                    <esri:ScaleLine Margin="10" HorizontalAlignment="Right"
                                                        VerticalAlignment="Bottom"
                                                        Map="{Binding ElementName=PrintMap}" />
                                    <esri:Attribution Margin="10,10,300,10" HorizontalAlignment="Left"
                                                          VerticalAlignment="Bottom"
                                                          Layers="{Binding Layers, ElementName=PrintMap}" />
                                </Grid>
                            </Border>

                            <!--  Date as Footer  -->
                            <TextBlock Grid.Row="2" HorizontalAlignment="Left"
                                           VerticalAlignment="Center"
                                           Text="{Binding Now, StringFormat='Printed {0:D} '}" />
                        </Grid>
                    </Grid>
                </ControlTemplate>

                <!--  Standard style with Title, Map, ScaleLine and Attribution  -->
                <ControlTemplate x:Key="Standard">
                    <Border Background="White">
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!--  Header  -->
                            <TextBlock Margin="10" HorizontalAlignment="Center"
                                           FontSize="22" Text="{Binding Title}"
                                           TextWrapping="Wrap" />

                            <!--  Map  -->
                            <Border Grid.Row="1" BorderBrush="Black"
                                        BorderThickness="1" CornerRadius="0">
                                <esri:Map x:Name="PrintMap" IsLogoVisible="False" view:CloneMap.Map="{Binding Map}" />
                            </Border>

                            <!--  Footer  -->
                            <Grid Grid.Row="2" Margin="0,10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*" />
                                    <ColumnDefinition Width="3*" />
                                </Grid.ColumnDefinitions>

                                <TextBlock HorizontalAlignment="Left" VerticalAlignment="Center"
                                               FontSize="16"
                                               Text="{Binding Now, StringFormat='Printed {0:d} '}" />
                                <TextBlock Grid.Column="1" HorizontalAlignment="Left"
                                               VerticalAlignment="Center" FontSize="14"
                                               Text="{Binding Scale, ElementName=PrintMap, StringFormat='1 : {0:F0} '}" />

                                <!--  Scale Bar  -->
                                <esri:ScaleLine Grid.Row="1" Grid.Column="1"
                                                    Map="{Binding ElementName=PrintMap}" TargetWidth="300" />

                                <!--  Attribution  -->
                                <esri:Attribution Grid.Row="2" Grid.Column="1" Layers="{Binding Layers, ElementName=PrintMap}" />
                            </Grid>
                        </Grid>
                    </Border>
                </ControlTemplate>

            </ResourceDictionary>
            <view:PreviewSizes x:Key="MyPreviewSizes">
                <view:PreviewSize Width="780" Height="1100" Id="A4 Portrait" />
                <view:PreviewSize Width="1100" Height="780" Id="A4 Landscape" />
                <view:PreviewSize Width="1100" Height="1560" Id="A3 Portrait" />
                <view:PreviewSize Width="1560" Height="1100" Id="A3 Landscape" />
                <view:PreviewSize Width="2200" Height="1560" Id="A2 Landscape" />
                <view:PreviewSize Width="3120" Height="2200" Id="A1 Landscape" />
                <view:PreviewSize Width="925" Height="1343" Id="B4 Portrait" />
                <view:PreviewSize Width="1343" Height="925" Id="B4 Landscape" />
                <view:PreviewSize Width="687" Height="971" Id="B5 Portrait" />
                <view:PreviewSize Width="971" Height="687" Id="B5 Landscape" />
                <view:PreviewSize Width="760" Height="1000" Id="Letter Portrait" />
                <view:PreviewSize Width="976" Height="760" Id="Letter Landscape" />
                <view:PreviewSize Width="665" Height="977" Id="Executive" />
                <view:PreviewSize Width="689" Height="415" Id="Envelope" />
            </view:PreviewSizes>

            <ControlTemplate
                x:Key="CompositeSymbol">
                <Grid>
                    <Ellipse Fill="{Binding Symbol.Color}" Width="{Binding Symbol.Size}"
                             Height="{Binding Symbol.Size}" Stroke="Black" StrokeThickness="1"/>
                    <TextBlock HorizontalAlignment="Center" 
                               VerticalAlignment="Center" 
                               Text="{Binding Path=Attributes[PointNumber]}"
                               FontSize="9" Margin="0" FontWeight="Bold" Foreground="Black"/>
                </Grid>
            </ControlTemplate>

            <esri:SimpleMarkerSymbol x:Key="AnchorPointSymbol"
                                     Size="20" Color="Crimson"
                                     ControlTemplate="{StaticResource CompositeSymbol}" />

            <ControlTemplate
                x:Key="LocationSymbol">
                <Grid>
                    <Image Source="/GisManagement;component/Image/AlarmPosition_D.png"></Image>
                </Grid>
            </ControlTemplate>

            <esri:SimpleMarkerSymbol x:Key="LocationPointSymbol"
                                     Size="20" Color="Crimson"
                                     ControlTemplate="{StaticResource LocationSymbol}" />

        </Grid.Resources>
        <Grid x:Name="MapControl" Grid.Row="0" >
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/>
                <RowDefinition Height="*"/>

            </Grid.RowDefinitions>
            <Grid Grid.Row="0" x:Name="ToolBar" VerticalAlignment="Top" HorizontalAlignment="Stretch">

                <Border x:Name="border"
                        Margin="0,0,0,0" 
                        Height="40" VerticalAlignment="Stretch" 
                        CornerRadius="0,0,0,0" HorizontalAlignment="Stretch" Opacity="1"  Background="Red">

                    <Grid Style="{StaticResource GisToolBarGridStyle}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Button x:Name="BtnPrevExtent" 
                                Grid.Column="1"
                                ToolTipService.ToolTip="{Binding [GIS_PreExtent], Source={StaticResource SR}}" 
                                Style="{StaticResource Gis_tle_ButtonCommonStyle}" Click="PrevExtent"  Margin="10,0,10,0">
                            <Image x:Name="Previouspng" Source="/ExternalResource;component/Images/Gisleft.png" Stretch="Fill" Width="24" Height="24"/>
                        </Button>

                        <Button x:Name="BtnNextExtent" 
                                Grid.Column="2"
                                ToolTipService.ToolTip="{Binding [GIS_NextExtent], Source={StaticResource SR}}" 
                                Style="{StaticResource Gis_tle_ButtonCommonStyle}" Click="NextExtent" Margin="10,0,10,0"
                                Cursor="Hand">
                            <Image x:Name="Nextpng" Source="/ExternalResource;component/Images/GisRight.png" Stretch="Fill" Width="24" Height="24"/>
                        </Button>

                        <Button x:Name="BtnGlobe" 
                                Grid.Column="3"
                                ToolTipService.ToolTip="{Binding [GIS_Globe], Source={StaticResource SR}}" 
                                Style="{StaticResource Gis_tle_ButtonCommonStyle}" Click="FullMapExtent" Margin="10,0,10,0">
                            <Image Source="/ExternalResource;component/Images/GisgGlobe.png" Stretch="Fill" Width="24" Height="24"/>
                        </Button>

                        <Button x:Name="BtnGlobeSwitch" 
                                Grid.Column="4"
                                ToolTipService.ToolTip="{Binding [GIS_GlobeSwitch], Source={StaticResource SR}}" 
                                Style="{StaticResource Gis_tle_ButtonCommonStyle}" Click="ChangeMapExtent" Margin="10,5,10,0">
                            <Image Source="/ExternalResource;component/Images/Globe_Switch.png" Stretch="Fill" Width="30" Height="30"/>
                        </Button>

                        <Button x:Name="BtnLength" 
                                Grid.Column="5"
                                ToolTipService.ToolTip="{Binding [GIS_Length], Source={StaticResource SR}}" 
                                Style="{StaticResource Gis_tle_ButtonCommonStyle}" Click="MeasureLength" Margin="10,0,10,0">
                            <Image Source="/ExternalResource;component/Images/GisDistince.png" Stretch="Fill" Width="24" Height="24"/>
                        </Button>

                        <Button x:Name="BtnArea" 
                                Grid.Column="6"
                                ToolTipService.ToolTip="{Binding [GIS_Area], Source={StaticResource SR}}"
                                Style="{StaticResource Gis_tle_ButtonCommonStyle}" Click="MeasureArea" Margin="10,0,10,0">
                            <Image Source="/ExternalResource;component/Images/GisMaxDistince.png" Stretch="Fill" Width="24" Height="24"/>
                        </Button>

                        <ToggleButton x:Name="BtnDrawMap"  
                                      Grid.Column="7"
                                      Style="{StaticResource ToggleButtonCommonStyle}" 
                                      ToolTipService.ToolTip="{Binding [GIS_DrawSomething], Source={StaticResource SR}}"  
                                      HorizontalAlignment="Left" VerticalAlignment="Center" Margin="10,0,10,0" Click="DrawMap"   
                                      Cursor="Hand">
                            <Image Source="/ExternalResource;component/Images/GisDraw.png" Stretch="Fill" Width="24" Height="24"/>
                        </ToggleButton>

                        <Button x:Name="BtnClearDisplay" 
                                Grid.Column="8"
                                ToolTipService.ToolTip="{Binding [GIS_ClearDisplay], Source={StaticResource SR}}" 
                                Style="{StaticResource Gis_tle_ButtonCommonStyle}" 
                                Command="{Binding ClearMapCommand}"
                                Margin="10,0,10,0">
                            <Image Source="/ExternalResource;component/Images/GisDelete.png" Stretch="Fill" Width="24" Height="24"/>
                        </Button>

                        <Button x:Name="BtnExportMap" 
                                Grid.Column="9"
                                ToolTipService.ToolTip="{Binding [GIS_ExportMap], Source={StaticResource SR}}" 
                                Style="{StaticResource Gis_tle_ButtonCommonStyle}"  
                                Click="ActivatePrintPreview" Margin="10,0,10,0">
                            <Image Source="/ExternalResource;component/Images/GisPrint.png" Stretch="Fill" Width="24" Height="24"/>
                        </Button>

                        <ToggleButton x:Name="MapQueryBtn"  
                                      Grid.Column="10"
                                      Style="{StaticResource ToggleButtonCommonStyle}" 
                                      ToolTipService.ToolTip="{Binding [GIS_FindAddress], Source={StaticResource SR}}"   
                                      HorizontalAlignment="Left" VerticalAlignment="Center" Margin="10,0,10,0" 
                                      Command="{Binding BtnIconSearchGeo}"
                                      >
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="Checked">
                                    <ei:GoToStateAction StateName="showQueryPanel"/>
                                </i:EventTrigger>
                                <i:EventTrigger EventName="Unchecked">
                                    <ei:GoToStateAction StateName="hiddenQueryPanel"/>
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                            <Image Source="/ExternalResource;component/Images/GisSearch.png" Stretch="Fill" Width="24" Height="24"/>
                        </ToggleButton>

                        <Button x:Name="BtnLocation" 
                                Grid.Column="11"
                                ToolTipService.ToolTip="{Binding [GIS_Locate], Source={StaticResource SR}}" 
                                Style="{StaticResource Gis_tle_ButtonCommonStyle}"  
                                Command="{Binding LocationCommand}" Margin="10,0,10,0">
                            <Image Source="/ExternalResource;component/Images/Location.png" Stretch="Fill" Width="24" Height="24"/>
                        </Button>

                        <Image Margin="0,0,0,0" >
                            <i:Interaction.Triggers>
                                <ei:DataTrigger  Binding="{Binding IsCarHisVisual}" Value="True">
                                    <ei:ControlStoryboardAction Storyboard="{StaticResource showHistoryLine}"/>
                                    <ei:ChangePropertyAction TargetObject="{Binding  ElementName=OpenHistoryLine}" PropertyName="IsChecked" Value="True"></ei:ChangePropertyAction>

                                </ei:DataTrigger>
                                <ei:DataTrigger  Binding="{Binding IsCarHisVisual}" Value="False">
                                    <ei:ControlStoryboardAction Storyboard="{StaticResource hiddenHistoryLine}"/>
                                    <ei:ChangePropertyAction TargetObject="{Binding  ElementName=OpenHistoryLine}" PropertyName="IsChecked" Value="False"></ei:ChangePropertyAction>
                                </ei:DataTrigger>
                            </i:Interaction.Triggers>
                        </Image>

                        <ToggleButton x:Name="OpenHistoryLine"  
                                      Grid.Column="12"
                                      Style="{StaticResource ToggleButtonCommonStyle}"  
                                      ToolTipService.ToolTip="{Binding [GIS_OpenHistoryTrace], Source={StaticResource SR}}"  
                                      HorizontalAlignment="Left" VerticalAlignment="Center" Margin="10,0,10,0" 
                                      Cursor="Hand">
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="Checked">
                                    <ei:ControlStoryboardAction Storyboard="{StaticResource showHistoryLine}"/>
                                    <ei:ChangePropertyAction TargetObject="{Binding}" PropertyName="IsCarHisOpen" Value="True"></ei:ChangePropertyAction>
                                </i:EventTrigger>
                                <i:EventTrigger EventName="Unchecked">
                                    <ei:ControlStoryboardAction Storyboard="{StaticResource hiddenHistoryLine}"/>
                                    <ei:ChangePropertyAction TargetObject="{Binding}" PropertyName="IsCarHisOpen" Value="False"></ei:ChangePropertyAction>
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                            <Image Source="/ExternalResource;component/Images/GisPath.png" Stretch="Fill" Width="24" Height="24"/>
                        </ToggleButton>
                    </Grid>
                </Border>
            </Grid>
            <Grid Grid.Row="1" 
                  x:Name="HistoryLine" 
                  Canvas.ZIndex="111" 
                  RenderTransformOrigin="0.5,0" 
                  Width="500" Height="250" Margin="0,0,0,0" 
                  HorizontalAlignment="Right" 
                  VerticalAlignment="Bottom" Opacity="0.85">
                <Grid.RenderTransform>
                    <CompositeTransform ScaleY="0"/>
                </Grid.RenderTransform>
                <view:GpsCarHisDataView x:Name="gpscarhisdatalist" IsDrag="True" />
            </Grid>

            <Border Grid.Row="1">
                <Grid>
                    <Grid x:Name="AddressQuery" Canvas.ZIndex="111"
                          RenderTransformOrigin="0.5,0" 
                          Width="500"  HorizontalAlignment="Right" 
                          Opacity="0.8">
                        <Grid.RenderTransform>
                            <CompositeTransform ScaleY="0" TranslateY="-5"/>
                        </Grid.RenderTransform>

                        <Grid x:Name="spatialQuery" VerticalAlignment="Top" Opacity="0.7" Background="#3d444b">

                            <Grid.RowDefinitions>
                                <RowDefinition Height="35"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>


                            <Border Style="{StaticResource PopupWindowTitleBorder}" Grid.Row="0" BorderThickness="0">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="20"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Text="{Binding [LocationQuery], Source={StaticResource SR}}" 
                                           Grid.Column="1" Foreground="White"
                                               HorizontalAlignment="Left"
                                               VerticalAlignment="Center"
                                           />
                                </Grid>
                            </Border>


                            <Grid Grid.Row="1">
                                <Grid.RowDefinitions>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="3*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <ComboBox  Visibility="Collapsed"  Grid.Row="0" Grid.Column="0" 
                                      ItemsSource="{Binding LocateTypeList,Mode=TwoWay}"
                                      DisplayMemberPath="Value"
                                      SelectedItem="{Binding LocateType,Mode=TwoWay}"
                                      Foreground="White"  ToolTipService.ToolTip="{Binding [PleaseSearchType], Source={StaticResource SR}}" 
                                          Margin="5,5,0,5"/>
                                <TextBox Grid.Row="1" Grid.Column="0" Text="{Binding Path=SearchContent,Mode=TwoWay}"
                                         Margin="5,5,0,5"/>

                                <Button Grid.Row="1" Grid.Column="1"
                                    Style="{StaticResource SearchButtonCommonStyle_Query}"
                                    ToolTipService.ToolTip="{Binding [Search], Source={StaticResource SR}}"
                                    Command="{Binding SpatialQueryCommand}"
                                        HorizontalAlignment="Left"
                                        Margin="5,5,0,5"/>

                            </Grid>
                            <sdk:DataGrid x:Name="SearchLocateInfoData" 
                                              Grid.Row="2"
                                              ItemsSource="{Binding QuerytContentList,Mode=TwoWay}"
                                              AutoGenerateColumns="False" 
                                              HeadersVisibility="None"
                                              MouseLeftButtonUp="LocateInfo_MouseLeftButtonUp"
                                              Height="285"
                                              Width="500"
                                              ColumnHeaderStyle="{StaticResource ColumnHeaderStyle}" 
                                              Style="{StaticResource DataGridStyleRxx}"
                                              >

                                <sdk:DataGrid.Columns>


                                    <sdk:DataGridTextColumn   Binding="{Binding Path=Key,Mode=TwoWay}"  FontWeight="Bold" Foreground="White" Width="50">
                                        <sdk:DataGridTextColumn.CellStyle>
                                            <Style TargetType="sdk:DataGridCell">
                                                <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                            </Style>
                                        </sdk:DataGridTextColumn.CellStyle>

                                    </sdk:DataGridTextColumn>
                                    <sdk:DataGridTextColumn Binding="{Binding Path=Value,Mode=TwoWay}" FontSize="9"  Foreground="White" Width="*">
                                        <sdk:DataGridTextColumn.CellStyle>
                                            <Style TargetType="sdk:DataGridCell">
                                                <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                                
                                            </Style>
                                        </sdk:DataGridTextColumn.CellStyle>

                                    </sdk:DataGridTextColumn>
                                </sdk:DataGrid.Columns>
                            </sdk:DataGrid>

                        </Grid>

                        <!--<view:SpatialQuery x:Name="spatialQuery" HorizontalAlignment="Right" Margin="0,3,3,0" VerticalAlignment="Top"></view:SpatialQuery>-->

                    </Grid>

                    <!--<Grid x:Name="MonitorList" Canvas.ZIndex="111" RenderTransformOrigin="0.5,0"  Width="350" HorizontalAlignment="Right" Opacity="0.75">
                        <Grid.RenderTransform>
                            <CompositeTransform ScaleY="0"/>
                        </Grid.RenderTransform>
                        <view:GpsCarList x:Name="monitorList"  HorizontalAlignment="Right" Margin="0,3,3,0" VerticalAlignment="Top"></view:GpsCarList>
                    </Grid>-->


                    <Grid x:Name="VectorMap">
                        <esri:Map x:Name="MyMap" IsLogoVisible="False" ExtentChanged="MyMap_ExtentChanged" MouseMove="MyMap_MouseMove" Loaded="MyMap_Loaded" MouseClick="MyMap_MouseClick"  MouseLeftButtonUp="MyMap_MouseLeftButtonUp">
                        <esri:GraphicsLayer ID="AntAppFeatureMapLayer_Fence" Visible="False" ></esri:GraphicsLayer>
                        <esri:GraphicsLayer ID="AntAppFeatureMapLayer_Rout"  Visible="False" ></esri:GraphicsLayer>
                        <esri:GraphicsLayer ID="AntAppFeatureMapLayer_BusStop"  Visible="False"></esri:GraphicsLayer>

                        <esri:GraphicsLayer ID="TrafficGraphicLayer" GraphicsSource="{Binding TrafficManagerGraphics, Source={StaticResource RouteManager}}" Visible="True"/>
                        <esri:GraphicsLayer ID="MonitorTrafficGraphicLayer" GraphicsSource="{Binding MonitorTrafficManagerGraphics, Source={StaticResource RouteManager}}" Visible="True"/>
                        <esri:ElementLayer ID="GpsHisDataSingleElement" Children="{Binding DisplayedGpsHisDataSingleVechileElements,Source={StaticResource RouteManager}}" Visible="True"/>
                        <esri:GraphicsLayer ID="GpsHisDataGraphics" GraphicsSource="{Binding DisplayedGpsHisDataVechileGraphics, Source={StaticResource RouteManager}}" Visible="True" />

                        <esri:GraphicsLayer ID="RealLocationGraphics" GraphicsSource="{Binding DisplayedVechileRealLocationGraphics, Source={StaticResource RouteManager}}" Visible="True"/>
                        <esri:GraphicsLayer ID="AlarmHappenLocationGraphics" GraphicsSource="{Binding DisplayedAlarmHappenLocationGraphics, Source={StaticResource RouteManager}}"/>
                        <esri:GraphicsLayer ID="AlertHappenLocationGraphics" GraphicsSource="{Binding DisplayedAlertHappenLocationGraphics, Source={StaticResource RouteManager}}"/>

                        <esri:ElementLayer ID="GpsHisDataElement" Children="{Binding DisplayedGpsHisDataVechileElements,Source={StaticResource RouteManager}}" Visible="True"/>
                        <esri:ElementLayer ID="AlertHappenLocationElement" Children="{Binding DisplayedAlertHappenLocationElements,Source={StaticResource RouteManager}}" Visible="False"/>
                        <esri:ElementLayer ID="AlarmHappenLocationElement" Children="{Binding DisplayedAlarmHappenLocationElements,Source={StaticResource RouteManager}}" Visible="False"/>
                        <esri:ElementLayer ID="RealLocationElement" Children="{Binding DisplayedVechileRealLocationElements,Source={StaticResource RouteManager}}"/>


                        <esri:GraphicsLayer ID="MeasureGraphicsLayer" />
                        <esri:GraphicsLayer ID="MyGraphicsLayer" Visible="True"/>
                        <esri:GraphicsLayer ID="MarkDistGraphicsLayer" Visible="True"/>
                        <esri:GraphicsLayer ID="FacilityTenMinThemeGraphicLayer"  Visible="True"/>
                        <esri:GraphicsLayer ID="FacilityFiveMinThemeGraphicLayer" Visible="True"/>
                        <esri:GraphicsLayer ID="FacilityThreeMinThemeGraphicLayer" Visible="True"/>
                        <esri:GraphicsLayer ID="TaxiThemeGraphicLayer" Visible="True"/>
                        <esri:GraphicsLayer ID="SnapshotLayer" Visible ="True"/>
                        <esri:GraphicsLayer ID="MyDrawGraphicsLayer"  MouseLeftButtonDown="GraphicsLayer_MouseLeftButtonDown"/>
                        <esri:GraphicsLayer ID="MyDrawQueryGraphicsLayer" />
                        <esri:GraphicsLayer ID="TrafficTempGraphicsLayer" Visible="True"/>

                        <!--锚点-->
                        <esri:GraphicsLayer ID="AnchorPointGraphicsLayer" x:Name="sds"/>

                    </esri:Map>
                    <esri:MapProgressBar x:Name="MyProgressBar" Map="{Binding ElementName=MyMap}" HorizontalAlignment="Center" VerticalAlignment="Bottom" Width="200" Height="36"></esri:MapProgressBar>
                    <Border BorderBrush="{StaticResource GridColorBrush}" BorderThickness="1" CornerRadius="3"
                HorizontalAlignment="Right" VerticalAlignment="Top"
                Margin="0,5,5,0" Style="{StaticResource TopBorderStyle}">
                        <Border.Effect>
                            <DropShadowEffect Color="#FF474747" Opacity="0.5" ShadowDepth="3" Direction="-90" BlurRadius="3"/>
                        </Border.Effect>
                        <Grid x:Name="EditGeometryTool" Background="Transparent" Visibility="{Binding EditGeometryVisble,Mode=TwoWay}">
                            <StackPanel Orientation="Vertical">
                                <StackPanel  Orientation="Horizontal">
                                    <Button Name="saveEditGeometry" Tag="saveEditGeometry" Margin="5" ToolTipService.ToolTip="{Binding [GIS_SaveEditGeometry], Source={StaticResource SR}}" Command="{Binding SaveEditGeometryCommand}">
                                        <Image Source="/ExternalResource;component/Images/save_icobox.png" Margin="2" />
                                    </Button>
                                    <Button x:Name="cancelEditGeometry" Tag="cancelEditGeometry" Margin="5" ToolTipService.ToolTip="{Binding [GIS_CancelEditGeometry], Source={StaticResource SR}}" Command="{Binding CancelEditGeometryCommand}">
                                        <Image Source="/ExternalResource;component/Images/cancel_icobox.png" Margin="2" />
                                    </Button>
                                    <Button x:Name="undoEditGeometry" Tag="undoEditGeometry" Margin="5" ToolTipService.ToolTip="{Binding [GIS_UndoEditGeometry], Source={StaticResource SR}}" Command="{Binding UndoEditGeometryCommand}">
                                        <Image Source="/ExternalResource;component/Images/back_icobox.png" Margin="2" />
                                    </Button>
                                    <Button  x:Name="redoEditGeometry" Tag="redoEditGeometry" Margin="5" ToolTipService.ToolTip="{Binding [GIS_RedoEditGeometry], Source={StaticResource SR}}" Command="{Binding RedoEditGeometryCommand}">
                                        <Image Source="/ExternalResource;component/Images/do_icobox.png" Margin="2" />
                                    </Button>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </Border>
                    </Grid>

                    <!--<Grid  Visibility="Collapsed" x:Name="ImageMap">
                        <esri:Map x:Name="MyDomMap" IsLogoVisible="False" ExtentChanged="MyDomMap_ExtentChanged" MouseMove="MyDomMap_MouseMove" Loaded="MyDomMap_Loaded" MouseClick="MyDomMap_MouseClick"  MouseLeftButtonUp="MyDomMap_MouseLeftButtonUp">
                            <esri:GraphicsLayer ID="AntAppFeatureMapLayer_Fence" Visible="False" ></esri:GraphicsLayer>
                            <esri:GraphicsLayer ID="AntAppFeatureMapLayer_Rout"  Visible="False" ></esri:GraphicsLayer>
                            <esri:GraphicsLayer ID="AntAppFeatureMapLayer_BusStop"  Visible="False"></esri:GraphicsLayer>

                            <esri:GraphicsLayer ID="TrafficGraphicLayer" GraphicsSource="{Binding TrafficManagerGraphics, Source={StaticResource RouteManager}}" Visible="True"/>
                            <esri:GraphicsLayer ID="MonitorTrafficGraphicLayer" GraphicsSource="{Binding MonitorTrafficManagerGraphics, Source={StaticResource RouteManager}}" Visible="True"/>
                            <esri:ElementLayer ID="GpsHisDataSingleElement" Children="{Binding DisplayedGpsHisDataSingleVechileElements,Source={StaticResource RouteManager}}" Visible="True"/>
                            <esri:GraphicsLayer ID="GpsHisDataGraphics" GraphicsSource="{Binding DisplayedGpsHisDataVechileGraphics, Source={StaticResource RouteManager}}" Visible="True" />

                            <esri:GraphicsLayer ID="RealLocationGraphics" GraphicsSource="{Binding DisplayedVechileRealLocationGraphics, Source={StaticResource RouteManager}}" Visible="True"/>
                            <esri:GraphicsLayer ID="AlarmHappenLocationGraphics" GraphicsSource="{Binding DisplayedAlarmHappenLocationGraphics, Source={StaticResource RouteManager}}"/>
                            <esri:GraphicsLayer ID="AlertHappenLocationGraphics" GraphicsSource="{Binding DisplayedAlertHappenLocationGraphics, Source={StaticResource RouteManager}}"/>

                            <esri:ElementLayer ID="GpsHisDataElement" Children="{Binding DisplayedGpsHisDataVechileElements,Source={StaticResource RouteManager}}" Visible="True"/>
                            <esri:ElementLayer ID="AlertHappenLocationElement" Children="{Binding DisplayedAlertHappenLocationElements,Source={StaticResource RouteManager}}" Visible="False"/>
                            <esri:ElementLayer ID="AlarmHappenLocationElement" Children="{Binding DisplayedAlarmHappenLocationElements,Source={StaticResource RouteManager}}" Visible="False"/>
                            <esri:ElementLayer ID="RealLocationElement" Children="{Binding DisplayedVechileRealLocationElements,Source={StaticResource RouteManager}}"/>


                            <esri:GraphicsLayer ID="MeasureGraphicsLayer" />
                            <esri:GraphicsLayer ID="MyGraphicsLayer" Visible="True"/>
                            <esri:GraphicsLayer ID="MarkDistGraphicsLayer" Visible="True"/>
                            <esri:GraphicsLayer ID="FacilityTenMinThemeGraphicLayer"  Visible="True"/>
                            <esri:GraphicsLayer ID="FacilityFiveMinThemeGraphicLayer" Visible="True"/>
                            <esri:GraphicsLayer ID="FacilityThreeMinThemeGraphicLayer" Visible="True"/>
                            <esri:GraphicsLayer ID="TaxiThemeGraphicLayer" Visible="True"/>
                            <esri:GraphicsLayer ID="SnapshotLayer" Visible ="True"/>
                            <esri:GraphicsLayer ID="MyDrawGraphicsLayer"  MouseLeftButtonDown="GraphicsLayer_MouseLeftButtonDown"/>
                            <esri:GraphicsLayer ID="MyDrawQueryGraphicsLayer" />
                            <esri:GraphicsLayer ID="TrafficTempGraphicsLayer" Visible="True"/>

                          
                            <esri:GraphicsLayer ID="AnchorPointGraphicsLayer" x:Name="domsds"/>

                        </esri:Map>
                        <esri:MapProgressBar x:Name="MyDomProgressBar" Map="{Binding ElementName=MyDomMap}" HorizontalAlignment="Center" VerticalAlignment="Bottom" Width="200" Height="36"></esri:MapProgressBar>
                        <Border BorderBrush="{StaticResource GridColorBrush}" BorderThickness="1" CornerRadius="3"
                HorizontalAlignment="Right" VerticalAlignment="Top"
                Margin="0,5,5,0" Style="{StaticResource TopBorderStyle}">
                            <Border.Effect>
                                <DropShadowEffect Color="#FF474747" Opacity="0.5" ShadowDepth="3" Direction="-90" BlurRadius="3"/>
                            </Border.Effect>
                            <Grid x:Name="DomEditGeometryTool" Background="Transparent" Visibility="{Binding EditGeometryVisble,Mode=TwoWay}">
                                <StackPanel Orientation="Vertical">
                                    <StackPanel  Orientation="Horizontal">
                                        <Button Name="DomsaveEditGeometry" Tag="saveEditGeometry" Margin="5" ToolTipService.ToolTip="{Binding [GIS_SaveEditGeometry], Source={StaticResource SR}}" Command="{Binding SaveEditGeometryCommand}">
                                            <Image Source="/ExternalResource;component/Images/save_icobox.png" Margin="2" />
                                        </Button>
                                        <Button x:Name="DomcancelEditGeometry" Tag="cancelEditGeometry" Margin="5" ToolTipService.ToolTip="{Binding [GIS_CancelEditGeometry], Source={StaticResource SR}}" Command="{Binding CancelEditGeometryCommand}">
                                            <Image Source="/ExternalResource;component/Images/cancel_icobox.png" Margin="2" />
                                        </Button>
                                        <Button x:Name="DomundoEditGeometry" Tag="undoEditGeometry" Margin="5" ToolTipService.ToolTip="{Binding [GIS_UndoEditGeometry], Source={StaticResource SR}}" Command="{Binding UndoEditGeometryCommand}">
                                            <Image Source="/ExternalResource;component/Images/back_icobox.png" Margin="2" />
                                        </Button>
                                        <Button  x:Name="DomredoEditGeometry" Tag="redoEditGeometry" Margin="5" ToolTipService.ToolTip="{Binding [GIS_RedoEditGeometry], Source={StaticResource SR}}" Command="{Binding RedoEditGeometryCommand}">
                                            <Image Source="/ExternalResource;component/Images/do_icobox.png" Margin="2" />
                                        </Button>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>-->

                    <!--标绘弹出工具条-->
                    <Border x:Name="MyDrawBorder" Canvas.ZIndex="111"
                            BorderBrush="{StaticResource GridColorBrush}" 
                            BorderThickness="1" 
                            CornerRadius="3"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Top"
                            Margin="5" >
                        <Border.Effect>
                            <DropShadowEffect Color="#FF474747" Opacity="0.5" ShadowDepth="3" Direction="-90" BlurRadius="3"/>
                        </Border.Effect>
                        <Border.Background>
                            <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                <GradientStop Color="#FFECECEC" Offset="0.033"/>
                                <GradientStop Color="#FFCDCDCD" Offset="1"/>
                                <GradientStop Color="White" Offset="0.021"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <Grid Background="Transparent" >

                            <StackPanel Orientation="Vertical" >
                                <StackPanel x:Name="MyDrawStackPanel" Orientation="Horizontal" >
                                    <Button Tag="DrawPoint" Margin="5" Click="Tool_Click" 
                                ToolTipService.ToolTip="{Binding [GIS_AddPoint], Source={StaticResource SR}}">
                                        <Image Source="/GisManagement;component/Image/DrawPoint.png" Margin="2" />
                                    </Button>
                                    <Button Tag="DrawPolyline" Margin="5" Click="Tool_Click"
                                ToolTipService.ToolTip="{Binding [GIS_AddPolyline], Source={StaticResource SR}}">
                                        <Image Source="/GisManagement;component/Image/DrawPolyline.png" Margin="2" />
                                    </Button>
                                    <Button Tag="DrawlineSegment" Margin="5" Click="Tool_Click"
                                ToolTipService.ToolTip="{Binding [GIS_AddLine], Source={StaticResource SR}}">
                                        <Image Source="/GisManagement;component/Image/DrawLineSegment.png" Margin="2" />
                                    </Button>
                                    <Button Tag="DrawPolygon" Margin="5" Click="Tool_Click"
                                ToolTipService.ToolTip="{Binding [GIS_AddPolygon], Source={StaticResource SR}}">
                                        <Image Source="/GisManagement;component/Image/DrawPolygon.png" Margin="2" />
                                    </Button>
                                    <Button Tag="DrawRectangle" Margin="5" Click="Tool_Click"
                                ToolTipService.ToolTip="{Binding [GIS_AddRectangle], Source={StaticResource SR}}">
                                        <Image Source="/GisManagement;component/Image/DrawRectangle.png" Margin="2" />
                                    </Button>
                                    <Button Tag="DrawFreehand" Margin="5" Click="Tool_Click"
                                ToolTipService.ToolTip="{Binding [GIS_AddFreeHandLine], Source={StaticResource SR}}">
                                        <Image Source="/GisManagement;component/Image/DrawFreehand.png" Margin="2" />
                                    </Button>
                                    <Button Tag="DrawArrow" Margin="5" Click="Tool_Click"
                                ToolTipService.ToolTip="{Binding [GIS_AddArrow], Source={StaticResource SR}}">
                                        <Image Source="/GisManagement;component/Image/DrawArrow.png" Margin="2" />
                                    </Button>
                                    <Button Tag="DrawTriangle" Margin="5" Click="Tool_Click"
                                ToolTipService.ToolTip="{Binding [GIS_AddTriggle], Source={StaticResource SR}}">
                                        <Image Source="/GisManagement;component/Image/DrawTriangle.png" Margin="2" />
                                    </Button>
                                    <Button Tag="DrawCircle" Margin="5" Click="Tool_Click"
                                ToolTipService.ToolTip="{Binding [GIS_AddCircle], Source={StaticResource SR}}">
                                        <Image Source="/GisManagement;component/Image/DrawCircle1.png" Margin="2" />
                                    </Button>
                                    <Button Tag="DrawEllipse" Margin="5" Click="Tool_Click"
                                ToolTipService.ToolTip="{Binding [GIS_AddEllipse], Source={StaticResource SR}}">
                                        <Image Source="/GisManagement;component/Image/DrawEllipse.png" Margin="2" />
                                    </Button>
                                    <Button Tag="ClearStopDraw" Margin="5" Click="Tool_Click"
                                Style="{x:Null}"
                                ToolTipService.ToolTip="{Binding [GIS_ClearGraphics], Source={StaticResource SR}}">
                                        <Image Source="/GisManagement;component/Image/StopDraw.png" Margin="2" />
                                    </Button>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <TextBlock x:Name="CoordTip" Foreground="Black"  Text="-------" VerticalAlignment="Bottom" HorizontalAlignment="Left" Opacity="0.7" Margin="20,0,0,0" />
                    <!--<TextBlock x:Name="UTMCoordTip" Foreground="Black"  VerticalAlignment="Bottom" HorizontalAlignment="Left" Opacity="0.7" Margin="250,0,0,0" />-->
                    <esri:Navigation   HorizontalAlignment="Left"  Margin="10,10,10,10" VerticalAlignment="Top"  Map="{Binding ElementName=MyMap}" Height="131" Width="160" Style="{StaticResource NavigationStyleSpan}" />
                    <esri:ScaleLine   HorizontalAlignment="Left" Margin="10,0,0,23" VerticalAlignment="Bottom"  Map="{Binding ElementName=MyMap}" MapUnit="Kilometers" />
                    <Grid x:Name="overviewgrid" HorizontalAlignment="Right" VerticalAlignment="Bottom" Width="201" Height="157" Visibility="Collapsed">
                        <Border Background="#BBcdd9e9" BorderThickness="1" BorderBrush="#cc95a9cb" Margin="10,10,-1,-2" >
                            <esri:OverviewMap  x:Name="OverViewMap" HorizontalAlignment="Stretch"  Margin="10" VerticalAlignment="Stretch"  Map="{Binding ElementName=MyMap}"  IsStatic="True" >
                                <!--<esri:ArcGISTiledMapServiceLayer  ID="OverviewMapLayer" Visible="True" InitializationFailed="ArcGISServiceLayer_InitializationFailed"/>-->
                            </esri:OverviewMap>
                        </Border>
                    </Grid>
                    <Button x:Name="BtnOverMap" Style="{StaticResource MapToolBtn}" Height="33" Width="39" VerticalAlignment="Bottom" HorizontalAlignment="Right" Click="OverViewClick" >
                        <Image Source="/ExternalResource;component/Images/OverMap.png" Stretch="Fill" Margin="0,0,5,5" Height="27" VerticalAlignment="Bottom"/>
                    </Button>

                    <Grid x:Name="PrintPreview" Style="{StaticResource ContentGridStyle}" Visibility="Collapsed" VerticalAlignment="Top"
                          Margin="0,0,0,0">
                        <Grid.ColumnDefinitions>
                            <!--  Print parameters  -->
                            <ColumnDefinition Width="Auto" />
                            <!--  Separator  -->
                            <ColumnDefinition Width="Auto" />
                            <!--  MapPrinter preview  -->
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>

                        <!--  Print parameters  -->
                        <Grid Grid.Column="0" MaxWidth="350" Margin="3">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <!--  Print properties row 0  -->
                            <Grid Grid.Row="0" Margin="10">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <toolkit:DockPanel Grid.ColumnSpan="2" HorizontalAlignment="Stretch">
                                        <TextBlock FontSize="16" FontWeight="Bold" Foreground="White" Text="{Binding [GIS_PrintSetting], Source={StaticResource SR}}" />
                                        <!--<toolkit:Separator Margin="0" Background="DarkGray" />-->
                                        <toolkit:Separator Margin="0" Background="#eeeeee" />
                                    </toolkit:DockPanel>

                                    <!--  Title  -->
                                    <TextBlock  Grid.Row="1" Margin="5"
                                                VerticalAlignment="Center"  Foreground="White" Text="{Binding [GIS_PrintTitle], Source={StaticResource SR}}" />
                                    <TextBox x:Name="PrintTitle" Grid.Row="1" Width="200" Grid.Column="1"
                                             Margin="5" VerticalAlignment="Center" MaxLength="150"
                                             HorizontalScrollBarVisibility="Hidden"
                                             Text="{Binding Title, Mode=TwoWay, ElementName=MyMapPrinter}"
                                             TextWrapping="Wrap" />

                                    <!--  Rotate map  -->
                                    <TextBlock Grid.Row="2" Margin="5"
                                               VerticalAlignment="Center" Foreground="White" Text="{Binding [GIS_RotateMap], Source={StaticResource SR}}" />
                                    <CheckBox Grid.Row="2" Grid.Column="1"
                                              Margin="5" VerticalAlignment="Center"
                                              IsChecked="{Binding RotateMap, Mode=TwoWay, ElementName=MyMapPrinter}" />

                                    <!--  Style selector from the PrintTemplates resource dictionary  -->
                                    <TextBlock Grid.Row="3" Margin="5"
                                                VerticalAlignment="Center" Foreground="White" Text="{Binding [GIS_PrintStyle], Source={StaticResource SR}}" />
                                    <ComboBox x:Name="MyPrintTemplateCombo" Grid.Row="3"
                                              Grid.Column="1" MinWidth="80"
                                              Margin="5" VerticalAlignment="Center"
                                              DisplayMemberPath="Key"
                                              ItemsSource="{StaticResource PrintTemplates}"
                                              SelectedIndex="1" SelectedValuePath="Value" />
                                </Grid>
                            </Grid>

                            <!--  Print Menu  row 1  -->
                            <Grid Grid.Row="1" Margin="10">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition />
                                        <RowDefinition />
                                        <RowDefinition />
                                        <RowDefinition />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <toolkit:DockPanel Grid.ColumnSpan="2">
                                        <TextBlock FontSize="16" FontWeight="Bold" Foreground="White" Text="{Binding [GIS_PrintMenu], Source={StaticResource SR}}" />
                                        <!--<toolkit:Separator Margin="0" Background="DarkGray" />-->
                                        <toolkit:Separator Margin="0" Background="#eeeeee" />
                                    </toolkit:DockPanel>

                                    <!--  Preview size selector  -->
                                    <TextBlock Grid.Row="1" Margin="5"
                                                VerticalAlignment="Center" Foreground="White" Text="{Binding [GIS_PrintSize], Source={StaticResource SR}}" />
                                    <ComboBox Grid.Row="1" Grid.Column="1"
                                              MinWidth="80" Margin="5"
                                              VerticalAlignment="Center" DisplayMemberPath="Id"
                                              ItemsSource="{StaticResource MyPreviewSizes}"
                                              SelectedIndex="0" SelectionChanged="OnPreviewSizeChanged" />

                                    <Grid Grid.Row="2" Grid.ColumnSpan="2">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="10"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>


                                        <Button x:Name="PrintButton"
                                                Grid.Column="0"
                                                VerticalAlignment="Center"
                                                Style="{StaticResource CancelButtonStyle}"
                                                HorizontalAlignment="Right" Click="OnPrint"
                                                Content="{Binding [GIS_PrintMap], Source={StaticResource SR}}"
                                                Width="100">
                                        </Button>

                                        <Button x:Name="ExpPngButton"
                                            Grid.Column="2" 
                                                VerticalAlignment="Center"
                                            HorizontalAlignment="Left" Click="BtnExportPng_Click_1"
                                                Content="{Binding [GIS_ExportMap], Source={StaticResource SR}}"
                                            Style="{StaticResource CancelButtonStyle}"
                                                Width="100">
                                        </Button>

                                    </Grid>


                                </Grid>
                            </Grid>
                            <!--  Busy indicator over all parameters  -->
                            <toolkit:BusyIndicator Grid.Row="0" Grid.RowSpan="2"
                                       BusyContent="Printing..."
                                       IsBusy="{Binding IsPrinting, ElementName=MyMapPrinter}" />

                            <!--  Footer with Cancel button row 2  -->
                            <StackPanel Grid.Row="2" VerticalAlignment="Bottom">
                                <toolkit:Separator Margin="50,0" Background="#eeeeee" />
                                <Button  Margin="5" Width="100"
                                        Click="DesactivatePrintPreview" 
                                        Content="{Binding [GIS_PrintReturn], Source={StaticResource SR}}"
                                        FontSize="14" 
                                         Style="{StaticResource CancelButtonStyle}"/>
                            </StackPanel>

                        </Grid>

                        <!--  Separator  column 1  -->
                        <Border Grid.Column="1" HorizontalAlignment="Stretch"
                    BorderBrush="Black" BorderThickness="1" />

                        <!--  Preview Map column 2  -->
                        <Grid Grid.Column="2">
                            <Border Margin="4" HorizontalAlignment="Center"
                        VerticalAlignment="Center" BorderBrush="Black"
                        BorderThickness="1">
                                <Border.Effect>
                                    <DropShadowEffect Direction="-45" Opacity="0.5" ShadowDepth="4" />
                                </Border.Effect>
                                <!--  Viewbox allows the whole mapprinter to be rendered in the allocate size  -->
                                <Viewbox>
                                    <view:MapPrinter x:Name="MyMapPrinter" Title=""
                                          Width="750" Height="1050"
                                          HorizontalContentAlignment="Stretch"
                                          VerticalContentAlignment="Stretch"
                                          Template="{Binding SelectedValue, ElementName=MyPrintTemplateCombo}" />
                                </Viewbox>
                            </Border>
                        </Grid>
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>
